<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <meta name="Lab6" content="">
    <meta name="Zhiyuan" content="">

    <title>Starter Template for Bootstrap</title>

    <!-- Bootstrap core CSS -->
    <link href="dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <!-- <link href="../../assets/css/ie10-viewport-bug-workaround.css" rel="stylesheet"> -->

    <!-- Custom styles for this template -->
    <link href="starter-template.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]>
    <script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <!-- <script src="../../assets/js/ie-emulation-modes-warning.js"></script> -->

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>

<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                    aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">Lab6</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
            <ul class="nav navbar-nav">
                <!--            <li class="index.html"><a href="#">Home</a></li>-->
                <!--            <li><a href="#intro">Introduction</a></li>-->
                <!--            <li><a href="#obj">Project Objective</a></li>-->
                <!--            <li><a href="#design">Procedure and Result</a></li>-->
                <!--            <li><a href="#drawings">Drawings</a></li>-->
                <!--            <li><a href="#testing">Testing</a></li>-->
                <!--            <li><a href="#result">Result</a></li>-->
            </ul>
        </div><!--/.nav-collapse -->
    </div>
</nav>

<div class="container">

    <div class="starter-template">
        <h1>Lab 6: Closed-loop control (PID) </h1>
        <h4>Zhiyuan Zhang</h4>


    </div>

    <!--      <hr>-->
    <!--      <div class="center-block">-->
    <!--          <iframe width="640" height="360" src="https://www.youtube.com/embed/dQw4w9WgXcQ" frameborder="0" allowfullscreen></iframe>-->
    <!--          <h4 style="text-align:center;">Demonstration Video</h4>-->
    <!--      </div>-->

    <hr id="intro">

    <div style="text-align:center;">
        <h2>Introduction</h2>
        <p style="text-align: left;padding: 0px 30px;"> The purpose of this lab is to get experience with PID control: I
            am going to implement PID control in my robot to finish the position control task. Basically the idea of
            this task is to have my robot drive as fast as possible towards the wall and stop when it is exactly 1 foot
            (304 mm) away from the wall using feedback from the ToF distance sensor. The PID controller in this task
            will be controlling the speed of my robot by considering the distance between my robot and the wall. </p>

        <hr id='obj'>

        <!--      <div class="row">-->
        <!--          <div class="col-md-4" style="text-align:center;">-->
        <!--          <img class="img-rounded" src="pics/1.jpg" alt="Generic placeholder image" width="240" height="240">-->
        <!--          </div>-->
        <!--          <div class="col-md-8" style="font-size:18px;">-->
        <!--          <h2>Project Objective:</h2>-->
        <!--          <ul>-->
        <!--              <li>some important objectives.some important objectives.some important objectives.some important objectives.</li>-->
        <!--                <li>some other important objectives.</li>-->
        <!--            <li>some not-that-important objectives.</li>-->
        <!--          </ul>-->
        <!--          </div>-->
        <!--      </div>-->

        <!--    <hr id='design'>-->

        <div style="text-align:center;">
            <h2>Lab Procedure And Result</h2>
            <h3>1. PreLab</h3>
            <p style="text-align: left;padding: 0px 30px;">
                To send command to the robot over bluetooth , I wrote a new case that start the robot by changing the
                flag to true,so that in the while main loop it will execute the PID control when the flag is ture.And to
                get the PID data, distance and time data from the robot.I also write a handler to retrieve the data from
                robot. In this way we can tune our PID control based on the PID data plot . The code snippet for the
                computer end is shown below:
                <script src="https://gist.github.com/Zhang9340/c82644693c1018b9532f7d34869deaaa.js"></script>
                <script src="https://gist.github.com/Zhang9340/a6c52846d0daa5e25a24eb4eda2c948a.js"></script>
                <script src="https://gist.github.com/Zhang9340/cbc1da21f3d9d000dea975b8cda6e638.js"></script>
            </p>

            <p style="text-align: left;padding: 0px 30px;">
                The code that robot handle the command from the computer, The code snippet is shown below:
                <script src="https://gist.github.com/Zhang9340/e2784e3f947f8e0e851b9cf47f371d06.js"></script>
                <script src="https://gist.github.com/Zhang9340/b15916409d59f638b1e1c1c76ad9a6c6.js"></script>
                <script src="https://gist.github.com/Zhang9340/fa46040c0beb03994a09561f4a68bb39.js"></script>

            </p>


            <h3>P/I/D discussion</h3>
            <p style="text-align: left;padding: 0px 30px;"> During the lab task, I established a specific distance as
                the target for implementing the PID control. The discrepancy between the measured distance and the
                established distance was regarded as the error. The PID control primarily comprises three parameters:
                Kp, Ki, and Kd. Kp is responsible for controlling the speed at which the steering turns while moving
                towards the target point. Ki adds more steering action to improve stability, whereas Kd is employed to
                damp oscillation. To choose the parameters, I initiated the testing process by
                only setting Kp to 0.5 and then gradually decreasing it. When the car responded quickly and moved
                towards the wall, I introduced Ki to decrease the overshoot and enhance control stability. Finally, I
                added
                Kd when the car began oscillating around the target point to minimize oscillation. The values for Kp,
                Ki, and Kd were determined to be 0.3, 0.001, and 60, respectively. It is important to note that an
                excessive integral can cause oscillation , which is why Ki is much smaller than Kp.</p>


            <h3>Range/Sampling time discussion</h3>
            <p style="text-align: left;padding: 0px 30px;">Since the TOF sensor has measurement error , so I set my
                tolerance for the distance is 8mm. Therefore, form range 292 to 308 , the robot will stop.The sampling
                time of TOF is fast enough for the PID contol process to update the new pwm for the motor </p>

            <h3> 4.Lab task</h3>
            <p style="text-align: left;padding: 0px 30px;">
                In this lab,I chose the task A. I wrote a pid function that is called in the main loop() when the
                computer send
                start command ,the code for the pid is shown below:
                <script src="https://gist.github.com/Zhang9340/831a6a44068f4f7d149f378ca368560c.js"></script>
                The code begins by retrieving the distance from the TOF sensor through the use of the get_tof()
                function. Once the distance is obtained, the code calculates the error. This error value is then fed as
                an input into the PID control system, which generates the PWM value
                for controlling the motor.
            </p>
            <p style="text-align: left;padding: 0px 30px;">
                The video below shows the result when I only set the KP= 0.3 for the PID ,and we can see there is
                oscillation:
            </p>
            <iframe width="560" height="315" src="https://www.youtube.com/embed/S2af8Gs4t38"
                    title="YouTube video player" frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    allowfullscreen></iframe>

            <p style="text-align: left;padding: 0px 30px;">
                After setting the KI=0.001 and KD=60 , The PID can contorll the motor stop at 300mm form the wall:
            </p>
            <iframe width="560" height="315" src="https://www.youtube.com/embed/-DhOQkIdf-Q"
                    title="YouTube video player" frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    allowfullscreen></iframe>
            <p style="text-align: left;padding: 0px 30px;">
                The figure below is distance measured versus time:
            </p>
            <img src="pics/dis.jpg" width="800">
            <p style="text-align: left;padding: 0px 30px;">
                The figure below is PWM versus time,when it is 300mm away form the wall, it should stop so the pwm is 0:
            </p>
            <img src="pics/pwm.jpg" width="800">


            <h3>5.WIND-UP IMPLEMENTATION AND DISCUSSION</h3>
            <p style="text-align: left;padding: 0px 30px;">
                In PID control, the integrator is responsible for accumulating the error signal over time and producing
                a corrective output to the system. However, in certain situations, the integrator can
                increase in the output signal that can cause instability and oscillations in the system.For example,
                it can make the pwm generated larger than 255, thereforeI set a upper and lower bound for the generated
                pwm
            </p>


        </div>

    </div>

</div><!-- /.container -->


<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="../../assets/js/vendor/jquery.min.js"><\/script>')</script>
<script src="dist/js/bootstrap.min.js"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<!-- <script src="../../assets/js/ie10-viewport-bug-workaround.js"></script> -->
</body>
</html>
